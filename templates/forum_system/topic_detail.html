{% extends 'base.html' %}

{% block title %}{{topic.title}}{% endblock %}

{% load custom_tags %}

{% block content %}

<head>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/forum-topic.css' %}">
</head>

<!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–ª–µ–≤–∞ —Å–≤–µ—Ä—Ö—É –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞ -->
<!-- –ê–≤–∞—Ç–∞—Ä –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
<a href="{% url 'profile' request.user.username %}">
    <div class="topics-user-field">
        <img src="{{ request.user.avatar.url }}" alt="avatar" class="topics-avatar">
        <div class="topics-user-name">{{ request.user.username }}</div>
    </div>
</a>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ topic -->
<div class="topics-main-container">
    <div class="topics-content">
        <h1 class="topics-title">{{ topic.title }}</h1>
        <p class="topics-description">{{ topic.content|linebreaks }}</p>
        <p class="topics-created">–°—Ç–≤–æ—Ä–µ–Ω–æ: <span>{{ topic.created_by }}</span></p>
        <p class="topics-likes">–°–ø–æ–¥–æ–±–∞–ª–æ—Å—è: <span>{{ likes_count }}</span></p>
    </div>
</div>

<!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∫–Ω–æ–ø–∫–æ–π –õ–∞–π–∫ –∏ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
<div class="topics-interaction-container">
    <form method="post">
        {% csrf_token %}
        <button type="submit" name="like" class="topics-like-btn">
            {% if request.user in topic.likes.all %}
                üëç –ù–µ –ø–æ–¥–æ–±–∞—î—Ç—å—Å—è
            {% else %}
                ‚ù§Ô∏è –ü–æ–¥–æ–±–∞—î—Ç—å—Å—è
            {% endif %}
        </button>
    </form>

    <button class="topics-comment-btn">üí¨</button>
</div>

<!-- –°–µ–∫—Ü–∏—è –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π -->
<div class="topics-comment-section">
    <form method="post">
        {% csrf_token %}
        <textarea name="content" class="topics-comment-input" rows="3" required placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –≤–∞—à –∫–æ–º–µ–Ω—Ç–∞—Ä" maxlength="1200"></textarea>
        <button type="submit" name="comment" class="topics-add-comment-btn">–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ—ó</button>
    </form>
</div>

<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±–ª–æ–∫ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ —Å–ø—Ä–∞–≤–∞ -->
<div class="topics-side-comments">
    <h2>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h2>
    <ul>
        {% for comment in comments %}
            <li>
                <strong>{{ comment.created_by.username }} {% if comment.created_by.pk == topic.created_by.pk %} [OP] {% endif %} :</strong>
                {{ comment.content }}
            </li>
        {% endfor %}
    </ul>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="topics-actions">
    {% if request.user == topic.created_by %}
        <a href="{% url 'update-topic' topic.id %}" class="topics-edit-btn">–ó–º—ñ–Ω–∏—Ç–∏</a>
        <a href="{% url 'delete-topic' topic.pk %}" class="topics-delete-btn">–í–∏–¥–∞–ª–∏—Ç–∏</a>
    {% endif %}
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–∑–∞–¥ -->
<a href="{% url 'category-detail' topic.category.id %}" class="topics-back-btn">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</a>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const commentBtn = document.querySelector('.topics-comment-btn');
        const commentSection = document.querySelector('.topics-comment-section');

        commentBtn.addEventListener('click', () => {
            commentSection.style.display = commentSection.style.display === 'block' ? 'none' : 'block';
        });
    });
</script>

<!-- <h2>–û–ø–∏—Ç—É–≤–∞–Ω–Ω—è</h2>
{% for poll in topic.polls.all %}
    <div>
        <h3>{{ poll.name }}</h3>
        <p>{{ poll.description }}</p>
        {% if request.user.is_authenticated and poll|has_voted:request.user %}
            <ul>
                {% for option in poll.options.all %}
                    <li>
                        {{ option.text }} - {{ option.votes }} –≥–æ–ª–æ—Å–∏
                        ({{ option.votes|floatformat:2 }}%)
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <form method="post" action="{% url 'vote' poll.id %}">
                {% csrf_token %}
                {% for option in poll.options.all %}
                    <label>
                        <input type="radio" name="option" value="{{ option.id }}">
                        {{ option.text }}
                    </label><br>
                {% endfor %}
                <button type="submit">–ì–æ–ª–æ—Å—É–≤–∞—Ç–∏</button>
            </form>
        {% endif %}
    </div>
{% empty %}
    <p>–ù–µ —ñ—Å–Ω—É—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Ç–µ–º.</p>
{% endfor %}

{% if request.user == topic.created_by %}
    <a href="{% url 'create-poll' topic.id %}">–°—Ç–≤–æ—Ä–∏—Ç–∏ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è</a>
{% endif %} -->
{% endblock %}
